## Поиск

### Тестовые данные
#### Расходы
```
создай раздел расходы
```
```
купил продукты в евроопт вчера тридцать восемь с половиной рублей
```
```
заправка на азс белнефть позавчера семьдесят два рубля
```
```
аптека здоровье три дня назад потратил пятнадцать рублей восемьдесят копеек
```
```
перевод на карту жены сегодня утром сто рублей
```
```
потратил на такси до вокзала в минске вечером в прошлую пятницу двенадцать рублей
```
```
купил кофе и булочку в макдональдс вчера восемь рублей девяносто копеек
```
#### Кладовка
```
добавь список кладовка
```
```
добавь в кладовку лобзик на 1 полку
```
```
добавь в кладовку дрель на 1 полку
```
```
добавь в кладовку ручной инструмент на 2 полку
```
```
добавь в кладовку крепеж на 3 полку
```
```
добавь в кладовку электрику на 4 полку
```

### Общие вопросы

```
какие есть списки
```
```
перечисли списки
```
```
сколько списков
```

### Вопросы по расходам
```
перечисли все расходы
```
```
что в расходах
```
```
расходы за последнюю неделю со словом вода
```
```
сводка по расходам день сумма
```
```
сколько записей в расходах
```
`
6
`

```
сумма расходов
```
`
247.2
`
```
сумма расходов за последние три дня
```
`
219.4
`
```
сумма расходов за последнюю неделю
```
`
последняя - это неделя перед текущей
`
```
что потрачено вчера
```
```
сколько потрачено вчера
```
`
47.4
`
```
средний чек за последнюю неделю
```
`
в расходах недели перед текущей сумму расходов разделить на их количество
`
```
какие средние дневные расходы
```
`
расходы за все дни разделить на количество дней  
61.8
`
```
сколько в среднем мы тратили в день за последнюю неделю
```
`
взять расходы за прошлую неделю и разделить на 7 
`
```
сколько и какие записи расходов больше 100 рублей
```
`
"need_count" и "need_analysis" 
`

## Различные запросы
### Фильтрация по папкам и данным
```
покажи записи из расход за вчера
```
```
найди всё в напоминании с датой 2025-04-05
```
```
есть ли что-то в кладовке без слова полка
```
```
покажи расходы больше 1000
```
```
были ли заметки в заметка 3 апреля
```

### Семантический поиск (по смыслу, не по словам)
```
найди где упоминается оплата
```
```
покажи похожее на нужно срочно
```
```
есть ли что-то про долг
```
```
найди напоминания о встрече
```
```
покажи всё что касается денег
```

### Мета-запросы и подсчёт
```
какие есть папки
```
```
сколько всего папок
```
```
есть ли папка доход
```
```
сколько записей в расход
```

### Расчёты и агрегация
```
подведи итог расходов за неделю
```
```
какие темы в заметка
```
```
сгруппируй расходы по дням
```
```
проанализируй траты за март
```
```
есть ли закономерность в расходах
```

TODO: 
есть ли что-то в кладовке без слова полка
что в заметках (часто запускает semantic)

Правила определения метода поиска:
- модель возвращает маркеры, по которым определяется метод поиска
- маркер имеет значение 1/0
- указанные действия выполняются когда маркер 1)
- "where_document" не маркер, это строка
- "filter" не маркер, просто обозначение операции

1. "semantic" (умный поиск):
   выполняет умный поиск в БД с заданным фильтром.
   Устанавливает "need_analysis".

2. "where_document" (поиск по слову или фразе):
   если выключены "need_filter" и "need_analysis" устанавливает "need_filter"
   если включен "semantic", удаляет результатов записи, 
   где отсутствует заданное слово или фраза.

3. "need_calculation" (арифметические расчеты):
   устанавливает "need_analysis"

4. "filter" (выборка из БД с фильтром):
   если снят "semantic" и установлены "need_analysis" или "need_filter"
   выполняет поиск в БД с заданным фильтром.

   На данном этапе получены записи для анализа, действий и вывода.

5. "query_is_about_lists" (запросы по спискам):
   устанавливает "need_analysis"

6. "need_count" (считает записи):
   Если установлен считает количество отобранных записей и добавляет их 
   к списку заметок с формулировкой "Количество записей/заметок: n".
   Если не установлен "need_analysis" сам выводит сообщение о количестве.

7. "need_analysis" (llm_smart):
   передает полученный список в модель и возвращает ответ.

8. "need_filter" (вывод списка):
   выводит список текстов заметок.

9. Выводит ответ, что результата нет.
